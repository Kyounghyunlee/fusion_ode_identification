data:
  data_dir: "data"
  # "all" will load all .npz files in data_dir
  shots: "all"
  intersection_rho_threshold: 0.05
  rom_n_interior: 16
  rom_interior_strategy: "chebyshev"

system:
  device: "gpu"

training:
  # Longer, higher-quality run
  num_restarts: 3

  optimizer: "adamw"
  learning_rate: 3.0e-4
  weight_decay: 1.0e-5

  # Longer AdamW phase before L-BFGS
  warmup_steps: 200
  total_steps: 5000
  batch_size: 64
  grad_clip: 1.0e4

  # logging
  log_every: 50

  # loss weights (explicit)
  huber_delta: 10.0
  lambda_src: 1.0e-5
  src_delta: 10.0
  lambda_w: 0.0
  model_error_delta: 20.0
  lambda_z: 1.0e-4
  lambda_zreg: 1.0e-5

  # Optional EMA (0 disables)
  ema_decay: 0.999

  # Enable a short, safe L-BFGS finetune after AdamW
  lbfgs_finetune: true
  lbfgs_maxiter: 200
  lbfgs_history: 10
  lbfgs_batch_shots: 2
  lbfgs_tol: 5.0e-5

output:
  model_id: "production_run_v1"
  save_dir: "models"
  log_dir: "logs"
  model_name: "tokamak ode model"

model:
  layers: 128
  depth: 4
  latent_gain: 1.0
  source_scale: 3.0e5
