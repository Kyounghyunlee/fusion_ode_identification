data:
  data_dir: "data"
  # "all" will load all .npz files in data_dir
  shots: "all"
  intersection_rho_threshold: 0.05
  rom_n_interior: 16
  rom_interior_strategy: "chebyshev"

system:
  device: "gpu"

training:
  # Keep a single pass (no restarts) for quick smoke
  num_restarts: 1

  optimizer: "adamw"
  learning_rate: 3.0e-4
  weight_decay: 1.0e-5

  # Short AdamW run to hand off to L-BFGS
  warmup_steps: 3
  total_steps: 10
  batch_size: 64
  grad_clip: 1.0e5

  # logging
  log_every: 100

  # loss weights (explicit)
  huber_delta: 10.0
  lambda_src: 1.0e-5
  src_delta: 10.0
  lambda_w: 0.0
  model_error_delta: 20.0
  lambda_z: 1.0e-4
  lambda_zreg: 1.0e-5

  # Optional EMA (0 disables)
  ema_decay: 0.0

  # Enable a short, safe L-BFGS finetune after AdamW
  lbfgs_finetune: true
  lbfgs_maxiter: 5
  lbfgs_history: 5
  lbfgs_batch_shots: 1
  lbfgs_tol: 1.0e-4

output:
  model_id: "production_run_v1"
  save_dir: "models"
  log_dir: "logs"
  model_name: "physics_manifold_model"

model:
  layers: 128
  depth: 4
  latent_gain: 1.0
  source_scale: 3.0e5
