data:
  data_dir: "data"
  # "all" will load all .npz files in data_dir
  shots: "all"

  # Uniform grid only
  rho_grid_mode: "uniform"
  # Optional. If omitted, uses the NPZ rho length.
  # uniform_n_rho: 26

  # BC
  edge_bc_mode: "use_last_observed"

system:
  device: "gpu"

training:
  # Longer, higher-quality run
  num_restarts: 1

  optimizer: "adamw"
  learning_rate: 2.0e-4
  weight_decay: 3.0e-5

  # Longer AdamW phase before L-BFGS
  warmup_steps: 1
  total_steps: 5
  batch_size: 10
  grad_clip: 1.0e3

  # logging
  log_every: 1

  # loss weights (explicit)
  huber_delta: 10.0
  lambda_src: 1.0e-4
  src_delta: 10.0
  lambda_w: 0.0
  model_error_delta: 20.0
  lambda_z: 1.0e-4
  lambda_zreg: 1.0e-5

  # ODE solver configuration
  solver: "imex"   # IMEX-only branch
  rtol: 1.0e-3
  atol: 1.0e-3

  # IMEX-specific configuration
  imex:
    theta: 0.7
    dt_base: 0.001
    substeps: 5
    max_steps: 50000
    rtol: 1.0e-4
    atol: 1.0e-6

  # Optional EMA (0 disables)
  ema_decay: 0.999

  # Enable a short, safe L-BFGS finetune after AdamW
  lbfgs_finetune: false
  lbfgs_maxiter: 2
  lbfgs_history: 1
  lbfgs_batch_shots: 2
  lbfgs_tol: 5.0e-5

output:
  model_id: "production_run_v1"
  save_dir: "models"
  log_dir: "logs"
  model_name: "tokamak ode model"

model:
  layers: 128
  depth: 4
  latent_gain: 1.0
  source_scale: 3.0e5
